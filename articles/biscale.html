<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bivarite Mapping with ggplot2 • biscale</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bivarite Mapping with ggplot2">
<meta property="og:description" content="biscale">
<meta property="og:image" content="https://slu-openGIS.github.io/biscale/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">biscale</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/biscale.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advanced.html">Advanced Options for Breaks and Legends</a>
    </li>
    <li>
      <a href="../articles/palettes.html">Palettes in Biscale</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/slu-openGIS/biscale/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Bivarite Mapping with ggplot2</h1>
                        <h4 data-toc-skip class="author">Christopher Prener, Ph.D.</h4>
            
            <h4 data-toc-skip class="date">2022-05-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/slu-openGIS/biscale/blob/HEAD/vignettes/biscale.Rmd" class="external-link"><code>vignettes/biscale.Rmd</code></a></small>
      <div class="hidden name"><code>biscale.Rmd</code></div>

    </div>

    
    
<p>Thematic choropleth maps are used to display quantities of some variable within areas, such as mapping median income across a city’s neighborhoods. However, we often think in bivariate terms - “how do race and income vary together?”. Maps that captures this, known as bivariate choropleth maps, are often perceived as difficult to create and interpret. The goal of <code>biscale</code> is to implement a consistent approach to bivariate mapping entirely within <code>R</code>. The package’s workflow is based on a 2019 <a href="https://timogrossenbacher.ch/2019/04/bivariate-maps-with-ggplot2-and-sf/" class="external-link">tutorial</a> written by Timo Grossenbacher and Angelo Zehr. <code>biscale</code> also contains a set of bivariate mapping palettes, including Joshua Stevens’ <a href="http://www.joshuastevens.net/cartography/make-a-bivariate-choropleth-map/" class="external-link">classive color schemes</a>.</p>
<p><img src="../reference/figures/biscale.001.jpeg" width="100%"></p>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>The easiest way to get <code>biscale</code> is to install it from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"biscale"</span><span class="op">)</span></code></pre></div>
<p>Alternatively, the development version of <code>biscale</code> can be accessed from GitHub with <code>remotes</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("remotes")</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"slu-openGIS/biscale"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="installing-dependencies">Installing Dependencies<a class="anchor" aria-label="anchor" href="#installing-dependencies"></a>
</h3>
<p>Since the package does not directly use functions from <code>sf</code>, it is a suggested dependency rather than a required one. However, the most direct approach to using <code>biscale</code> is with <code>sf</code> objects, and we therefore recommend users install <code>sf</code>. Windows and macOS users should be able to install <code>sf</code> without significant issues unless they are building from source. Linux users will need to install several open source spatial libraries to get <code>sf</code> itself up and running.</p>
</div>
<div class="section level3">
<h3 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h3>
<p>All functions within <code>biscale</code> use the prefix <code>bi_</code> to leverage the auto-completion features of RStudio and other IDEs.</p>
</div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p><code>biscale</code> contains a data set of U.S. Census tracts for the City of St. Louis in Missouri. Both median income and the percentage of white residents are included, both of which can be used to demonstrate the package’s functionality.</p>
</div>
<div class="section level3">
<h3 id="preparing-data">Preparing Data<a class="anchor" aria-label="anchor" href="#preparing-data"></a>
</h3>
<p>Once data are loaded, bivariate classes can be applied with the <code><a href="../reference/bi_class.html">bi_class()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># load dependencies</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">library</span>(biscale)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># create classes</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> data <span class="ot">&lt;-</span> <span class="fu">bi_class</span>(stl_race_income, <span class="at">x =</span> pctWhite, <span class="at">y =</span> medInc, <span class="at">style =</span> <span class="st">"quantile"</span>, <span class="at">dim =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>The <code>dim</code> argument is used to control the extent of the legend - do you want to produce a two-by-two map (<code>dim = 2</code>), a three-by-three map (<code>dim = 3</code>), or a four-by-four map (<code>dim = 4</code>)? <em>Note that support for four-by-four mapping is new as of v1.0.0!</em></p>
<p>Classes can be applied with the <code>style</code> parameter using four approaches for calculating breaks: <code>"quantile"</code> (default), <code>"equal"</code>, <code>"fisher"</code>, and <code>"jenks"</code>. The default <code>"quantile"</code> approach will create relatively equal “buckets” of data for mapping, with a break created at the median (50th percentile) for a two-by-two map or at the 33rd and 66th percentiles for a three-by-three map. For a four-by-four map, breaks are created at the 25th, 50th (median), and 75th percentiles.</p>
<p><img src="../reference/figures/biscale.002.jpeg" width="100%"></p>
<p>With the sample data, this creates a <em>very</em> broad range for the percent white measure in particular. Using one of the other approaches to calculating breaks yields a narrower range for the breaks and produces a map that does not overstate the percent of white residents living on the north side of St. Louis:</p>
<p><img src="../reference/figures/biscale.003.jpeg" width="100%"></p>
<p>Users should therefore choose methods for calculating breaks carefully as well as the number of dimensions mapped.</p>
<p><em>As of <code>v1.0</code>, <code>biscale</code> now supports larger dimension maps as well as custom breaks for maps. For an overview of these options, see the “Advanced Options” vignette.</em></p>
</div>
<div class="section level3">
<h3 id="mapping-data">Mapping Data<a class="anchor" aria-label="anchor" href="#mapping-data"></a>
</h3>
<p>Once breaks are created, we can use <code><a href="../reference/bi_scale_fill.html">bi_scale_fill()</a></code> as part of our <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code> call:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create map</span>
<span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">bi_class</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/bi_scale_fill.html">bi_scale_fill</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="st">"GrPink"</span>, dim <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Race and Income in St. Louis, MO"</span>,
    subtitle <span class="op">=</span> <span class="st">"Gray Pink (GrPink) Palette"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/bi_theme.html">bi_theme</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>This requires that the variable <code>bi_class</code>, created with <code><a href="../reference/bi_class.html">bi_class()</a></code>, is used as the fill variable in the aesthetic mapping. We also want to remove the legend from the plot since it will not accurately communicate the complexity of the bivariate scale.</p>
<p>The dimensions of the scale must again be supplied for <code><a href="../reference/bi_scale_fill.html">bi_scale_fill()</a></code> (they should match the dimensions given for <code><a href="../reference/bi_class.html">bi_class()</a></code>!), and a palette must be given. For reference, the top image above uses the <code>"DkBlue"</code> palette, the map images in the breaks section above use the <code>"DkViolet"</code> palette, and the map constructed in this section (and displayed below) uses the <code>"GrPink"</code> palette. <em>Note that, as of v1.0.0, the number of options for palettes has been expanded and there is increased support for custom palettes. See the “Palettes” vignette or <code><a href="../reference/bi_pal.html">?bi_pal</a></code> for more details.</em></p>
<p>If you are mapping point data, there is an alternative function <code><a href="../reference/bi_scale_color.html">bi_scale_color()</a></code> that works the same way as <code><a href="../reference/bi_scale_fill.html">bi_scale_fill()</a></code>.</p>
<p>The example above also includes <code><a href="../reference/bi_theme.html">bi_theme()</a></code>, which is based on the theme designed by <a href="https://timogrossenbacher.ch/2019/04/bivariate-maps-with-ggplot2-and-sf/" class="external-link">Timo Grossenbacher and Angelo Zehr</a>. This theme creates a simple, clean canvas for bivariate mapping that removes any possible distracting elements.</p>
</div>
<div class="section level3">
<h3 id="creating-legends">Creating Legends<a class="anchor" aria-label="anchor" href="#creating-legends"></a>
</h3>
<p>We’ve set <code>show.legend = FALSE</code> so that we can add (manually) our own bivariate legend. The legend itself can be created with the <code><a href="../reference/bi_legend.html">bi_legend()</a></code> function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">legend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bi_legend.html">bi_legend</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="st">"GrPink"</span>,
                    dim <span class="op">=</span> <span class="fl">3</span>,
                    xlab <span class="op">=</span> <span class="st">"Higher % White "</span>,
                    ylab <span class="op">=</span> <span class="st">"Higher Income "</span>,
                    size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></code></pre></div>
<p>The palette and dimensions should match what has been used for both <code><a href="../reference/bi_class.html">bi_class()</a></code> (in terms of dimensions) and <code><a href="../reference/bi_scale_fill.html">bi_scale_fill()</a></code> (in terms of both dimensions and palette). The <code>size</code> argument controls the font size used on the legend. Note that <a href="https://stat.ethz.ch/R-manual/R-devel/library/grDevices/html/plotmath.html" class="external-link"><code>plotmath</code></a> is used to draw the arrows since Unicode arrows are font dependent. This happens internally as part of <code><a href="../reference/bi_legend.html">bi_legend()</a></code> - you don’t need to include them in your <code>xlab</code> and <code>ylab</code> arguments!</p>
<p>With our legend drawn, we can then combine the legend and the map with a package like <code>cowplot</code>. The values needed for this stage will be subject to experimentation depending on the shape of the map itself.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># combine map with legend</span>
<span class="va">finalPlot</span> <span class="op">&lt;-</span> <span class="fu">ggdraw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">draw_plot</span><span class="op">(</span><span class="va">map</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">draw_plot</span><span class="op">(</span><span class="va">legend</span>, <span class="fl">0.2</span>, <span class="fl">.65</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span></code></pre></div>
<p>This approach allows us to customize legend’s placement and size to suit different map layouts. All of the maps shown as part of this vignette were produced using this approach. There are other approaches you could take as well that do not use <code>cowplot</code>. Note that, because <code>cowplot</code> requires <code>R</code> v3.5, it is not included as a <em>suggested</em> package (to maintain backward compatibility). <em>Beginning with v1.0.0, there are additional options for constructing legends with <code>biscale</code>. Please see the “Advanced Options” vignette for more details!</em></p>
<p>The completed map, created with the sample code in this vignette, looks like this:</p>
<p><img src="../reference/figures/biscale.004.jpeg" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="getting-help">Getting Help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<ul>
<li>If you are new to <code>R</code> itself, welcome! Hadley Wickham’s <a href="http://r4ds.had.co.nz" class="external-link"><em>R for Data Science</em></a> is an excellent way to get started with data manipulation in the tidyverse, which <code>biscale</code> is designed to integrate seamlessly with.</li>
<li>If you are new to spatial analysis in <code>R</code>, we strongly encourage you check out the excellent new <a href="https://geocompr.robinlovelace.net" class="external-link"><em>Geocomputation in R</em></a> by Robin Lovelace, Jakub Nowosad, and Jannes Muenchow.</li>
<li>If you have questions about using <code>biscale</code>, you are encouraged to use the <a href="https://community.rstudio.com" class="external-link">RStudio Community forums</a>. Please create a <a href="http://reprex.tidyverse.org/" class="external-link"><code>reprex</code></a> before posting. Feel free to tag Chris (<code>@chris.prener</code>) in any posts about <code>biscale</code>.</li>
<li>If you think you’ve found a bug, please create a <a href="http://reprex.tidyverse.org/" class="external-link"><code>reprex</code></a> and then open an issue on <a href="https://github.com/slu-openGIS/biscale/issues/new/choose" class="external-link">GitHub</a>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="suggesting-features-or-changes">Suggesting Features or Changes<a class="anchor" aria-label="anchor" href="#suggesting-features-or-changes"></a>
</h2>
<p>If you have features or suggestions you want to see implemented, please open an issue on <a href="https://github.com/slu-openGIS/biscale/issues/new/choose" class="external-link">GitHub</a> (and ideally created a <a href="http://reprex.tidyverse.org/" class="external-link"><code>reprex</code></a> to go with it!). Please note that this project is released with a <a href="https://slu-opengis.github.io/biscale/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://chris-prener.github.io" class="external-link">Christopher Prener</a>, Timo Grossenbacher, Angelo Zehr.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
