<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rasters • biscale</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Rasters">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">biscale</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/biscale.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bivariate_palettes.html">Bivariate Palettes</a>
    </li>
    <li>
      <a href="../articles/breaks.html">Options for Breaks and Legends</a>
    </li>
    <li>
      <a href="../articles/rasters.html">Rasters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/chris-prener/biscale/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Rasters</h1>
                        <h4 data-toc-skip class="author">Christopher
Prener, Ph.D.</h4>
            
            <h4 data-toc-skip class="date">2025-09-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/chris-prener/biscale/blob/main/vignettes/rasters.Rmd" class="external-link"><code>vignettes/rasters.Rmd</code></a></small>
      <div class="hidden name"><code>rasters.Rmd</code></div>

    </div>

    
    
<p>Though <code>biscale</code> focuses on bivariate mapping with vector
data, it is possible to adapt its workflow to create bivariate maps with
rasters. The following example is a reproducible example that relies on
some additional data and dependencies that go beyond what comes
installed with <code>biscale</code> itself.</p>
<div class="section level2">
<h2 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a>
</h2>
<p>To follow along with this example, you will need the
<code>raster</code> package for working with raster data and the
<code>faux</code> package for simulating a second variable:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"faux"</span>,<span class="st">"raster"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In addition, you’ll need the <code>cowplot</code> package, which is a
suggested dependency for <code>biscale</code>. You can either install it
individually (faster) or install all of the suggested dependencies at
once (slower, will also give you a number of other packages you may or
may not want):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## install just cowplot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"cowplot"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## install all suggested dependencies</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"biscale"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Once you have the dependencies installed, load the following
packages:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://chris-prener.github.io/biscale/">biscale</a></span><span class="op">)</span>   <span class="co"># bivariate mapping</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span>   <span class="co"># combine ggplot2 objects</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/debruine/faux" class="external-link">faux</a></span><span class="op">)</span>      <span class="co"># create simulated data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>   <span class="co"># create maps</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span>    <span class="co"># work with raster data</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sample-data">Sample Data<a class="anchor" aria-label="anchor" href="#sample-data"></a>
</h2>
<p>The data for this example are stored in <code>biscale</code>’s GitHub
repository. They are a selection from <a href="https://www.neonscience.org/" class="external-link">NEON’s</a> <a href="https://figshare.com/articles/dataset/Spatio_temporal_Series_Teaching_Data_Subsets/2009586" class="external-link">Spatio-temporal
Teaching Data Subset</a>, which are available on figshare. These data
were created by Leah Wasser and Megan A. Jones, and are available under
a CC-BY 4.0 license.</p>
<p>The data consist of a <code>.tif</code> file describing elevation in
the Harvard Forest in Massachusetts. They need to be downloaded from
GitHub into your <code>R</code> session since they do not come within
the package itself due to the size of the file:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_HARV</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="st">"https://github.com/chris-prener/biscale/raw/main/data-raw/NEON_HARV_dsmCrop.tif"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>Once you have the raster data downloaded, you will need to convert
them from a <code>RasterLayer</code> class object to a
<code>data.frame</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">neon_harv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">DSM_HARV</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Next, we’ll create a vector correlated with the <code>y</code> column
to simulate a bivariate relationship that we can map. To do this, we’ll
use the <code>fuax::rnorm_pre()</code> function to create a variable
that has a moderately strong correlation with <code>y</code> along with
a mean of 10 and a standard deviation of 2:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## create simulated data</span></span>
<span><span class="va">neon_harv</span><span class="op">$</span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu">rnorm_pre</span><span class="op">(</span><span class="va">neon_harv</span><span class="op">$</span><span class="va">y</span>, mu <span class="op">=</span> <span class="fl">10</span>, sd <span class="op">=</span> <span class="fl">2</span>, r <span class="op">=</span> <span class="fl">0.7</span>, empirical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## rename NEON_HARV_dsmCrop</span></span>
<span><span class="va">neon_harv</span><span class="op">$</span><span class="va">ele</span> <span class="op">&lt;-</span> <span class="va">neon_harv</span><span class="op">$</span><span class="va">NEON_HARV_dsmCrop</span></span>
<span></span>
<span><span class="co">## reorder variables</span></span>
<span><span class="va">neon_harv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">neon_harv</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ele</span>, <span class="va">sim</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we’ll create our <code>bi_class</code> column using the same
process we use with vector data. For this example, we’ll compare our
simulated data with the elevation data in the raster:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">neon_harv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bi_class.html">bi_class</a></span><span class="op">(</span><span class="va">neon_harv</span>, x <span class="op">=</span> <span class="va">ele</span>, y <span class="op">=</span> <span class="va">sim</span>, style <span class="op">=</span> <span class="st">"quantile"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bivariate-raster-mapping">Bivariate Raster Mapping<a class="anchor" aria-label="anchor" href="#bivariate-raster-mapping"></a>
</h2>
<p>Mapping these raster data follows the same general workflow as our
vector data examples, but requires a few minor modifications. Instead of
using <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">ggplot2::geom_sf()</a></code>, we’ll use
<code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">ggplot2::geom_raster()</a></code>. The arguments passed to
<code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster()</a></code> remain generally the same, however we need to
explicitly name the <code>x</code> and <code>y</code> columns:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">neon_harv</span> , <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">bi_class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/bi_scale_fill.html">bi_scale_fill</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="st">"DkBlue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Harvard Forest"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">""</span>,</span>
<span>    y <span class="op">=</span> <span class="st">""</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Data via NEON Spatio-temporal Teaching Data Subset"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/bi_theme.html">bi_theme</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p>There are a few other key differences with the raster workflow to
note: * To project the data, we’ll use
<code><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">ggplot2::coord_quickmap()</a></code> * To suppress the default legend,
we need to use <code>theme(legend.position="none")</code> * Likewise, we
need to explicitly hide the <code>x</code> and <code>y</code> axis
labels using the <code><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs()</a></code> function</p>
<p>All of the legend construction steps are the same as for vector
data:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">legend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bi_legend.html">bi_legend</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="st">"DkBlue"</span>,</span>
<span>                    xlab <span class="op">=</span> <span class="st">"Higher Elevation "</span>,</span>
<span>                    ylab <span class="op">=</span> <span class="st">"Higher Simulated Var "</span>,</span>
<span>                    size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p>To combine our map with the legend, however, we need to place the
legend next to the raster instead of overlaying it as we did with the
other examples using the vector data. This process, using
<code><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">cowplot::plot_grid()</a></code>, looks a bit different but achieves a
great looking result:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## construct final plot</span></span>
<span><span class="va">finalPlot</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">map</span>, <span class="va">legend</span>,</span>
<span>  rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.4</span><span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## print final plot</span></span>
<span><span class="va">finalPlot</span></span></code></pre></div>
<p><img src="../reference/figures/raster.jpeg" width="100%"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://chris-prener.github.io" class="external-link">Christopher Prener</a>, Timo Grossenbacher, Angelo Zehr.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
